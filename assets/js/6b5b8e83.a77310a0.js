"use strict";(self.webpackChunkrotorflight_docs=self.webpackChunkrotorflight_docs||[]).push([[5145],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>f});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var s=n.createContext({}),p=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},c=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(r),m=a,f=u["".concat(s,".").concat(m)]||u[m]||d[m]||i;return r?n.createElement(f,o(o({ref:t},c),{},{components:r})):n.createElement(f,o({ref:t},c))}));function f(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=r.length,o=new Array(i);o[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[u]="string"==typeof e?e:a,o[1]=l;for(var p=2;p<i;p++)o[p]=r[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},5572:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var n=r(7462),a=(r(7294),r(3905));const i={sidebar_position:120},o="RPM Filters",l={unversionedId:"Tutorial - Setup/RPM Filters",id:"Tutorial - Setup/RPM Filters",title:"RPM Filters",description:"RPM filters clean up the gyro signals by filtering out vibrations that are coming from the rotating parts in a helicopter: the main rotor, tail rotor and motor(s).",source:"@site/docs/Tutorial - Setup/RPM Filters.md",sourceDirName:"Tutorial - Setup",slug:"/Tutorial - Setup/RPM Filters",permalink:"/docs/Tutorial - Setup/RPM Filters",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Tutorial - Setup/RPM Filters.md",tags:[],version:"current",sidebarPosition:120,frontMatter:{sidebar_position:120},sidebar:"tutorialSidebar",previous:{title:"ESC Telemetry",permalink:"/docs/Tutorial - Setup/ESC Telemetry"},next:{title:"LED Strip",permalink:"/docs/Tutorial - Setup/LED Strip"}},s={},p=[],c={toc:p},u="wrapper";function d(e){let{components:t,...i}=e;return(0,a.kt)(u,(0,n.Z)({},c,i,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"rpm-filters"},"RPM Filters"),(0,a.kt)("p",null,"RPM filters clean up the gyro signals by filtering out vibrations that are coming from the rotating parts in a helicopter: the main rotor, tail rotor and motor(s)."),(0,a.kt)("p",null,"The difference between an unfiltered and filtered signal is significant. Here's an example of filtered and unfiltered gyro signals:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Gyro signals",src:r(2780).Z,width:"1393",height:"940"})),(0,a.kt)("p",null,"RPM filtered gyro signals enable you to tune the helicopter better, for example by being able to use higher gains."),(0,a.kt)("p",null,"The RPM filters require real time motor speed information to be available to the flight controller. This can be obtained with a ",(0,a.kt)("a",{parentName:"p",href:"todo"},"frequency sensor")," or by using ",(0,a.kt)("a",{parentName:"p",href:"todo"},"bidirectional DSHOT"),"."),(0,a.kt)("p",null,"Once the FC knows the motor speed, it can calculate the main and tail rotor speeds. For this it needs to know the ",(0,a.kt)("em",{parentName:"p"},"Main Rotor Gear Ratio")," and the ",(0,a.kt)("em",{parentName:"p"},"Tail Rotor Gear Ratio"),", which you can specify in the ",(0,a.kt)("em",{parentName:"p"},"Motors")," tab."),(0,a.kt)("p",null,"For example, here are the ratios for my Gaui X3."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Gear ratios",src:r(6493).Z,width:"803",height:"407"})),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"Direct drive motors have a ratio of 1:1.")),(0,a.kt)("p",null,"In order to use RPM filters, enable the feature ",(0,a.kt)("em",{parentName:"p"},"RPM_FILTER")," in the ",(0,a.kt)("em",{parentName:"p"},"Configuration")," tab."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"RPM feature",src:r(9478).Z,width:"805",height:"387"})),(0,a.kt)("p",null,"Next, enable the ",(0,a.kt)("em",{parentName:"p"},"Gyro RPM Notch Filters")," in the ",(0,a.kt)("em",{parentName:"p"},"Gyro")," tab. These settings should be ok for a first flight."),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"RPM enable",src:r(2608).Z,width:"803",height:"995"})),(0,a.kt)("p",null,"Filters introduce latency. More filters mean more latency. So try to keep the number of filters low."),(0,a.kt)("p",null,"Double filters provide heavier filtering than single filters, but are also slower. They are sometimes needed on the 1st and/or 2nd harmonic."),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"The Q factor defines how wide the filter is:"),(0,a.kt)("ul",{parentName:"admonition"},(0,a.kt)("li",{parentName:"ul"},"Lower Q values make the filter wider"),(0,a.kt)("li",{parentName:"ul"},"Higher Q values make the filter smaller"))),(0,a.kt)("p",null,"Wider filters are slower than narrow filters, so try to make the filters as small as possible without it being ineffective."),(0,a.kt)("h1",{id:"filter-tuning"},"Filter tuning"),(0,a.kt)("p",null,"Make a blackbox log of a short flight with constant headspeed. Scroll to the point where the heli has spooled up and is hovering. Mark that point with the ",(0,a.kt)("inlineCode",{parentName:"p"},"I")," key. Scroll near the end and mark that with the ",(0,a.kt)("inlineCode",{parentName:"p"},"O")," key. Now bring up the ",(0,a.kt)("em",{parentName:"p"},"Analyzer Display")," and enlarge it. It might look like:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Missing filters",src:r(5874).Z,width:"1393",height:"940"})),(0,a.kt)("p",null,"This log was made with only a double fundamental filter. As you can see there's some noise around 144Hz. Since the headspeed is 4200 RPM, that must be near the second harmonic (4200/60 = 70*2 = 140Hz). Also note that the gyro signal in the background is also a bit noisy."),(0,a.kt)("p",null,"Now let's add some single filters for the 2nd (140Hz) and 3rd (210Hz) harmonic. Suddenly the log looks a lot cleaner:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Added filters",src:r(305).Z,width:"1393",height:"940"})))}d.isMDXComponent=!0},6493:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/motors-gear-ratios-e78d5d9f7edfdfa808e39ec7459b55d8.png"},2608:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/rpm-enable-filters-adfc631e33ebdbbcf15fdf6e1903cd7e.png"},9478:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/rpm-feature-04acad43107b077412b95adbf84f4d56.png"},305:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/rpm-filters-added-e59278055fba570a444e245705faac94.png"},5874:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/rpm-filters-missing-636f4c3a9a935c4644dea41490fb2cae.png"},2780:(e,t,r)=>{r.d(t,{Z:()=>n});const n=r.p+"assets/images/rpm-unfiltered-20b6697aa790a2143f27566f94663ca7.png"}}]);